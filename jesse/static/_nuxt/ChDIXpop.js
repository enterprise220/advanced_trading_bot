import{g as z,h as J,r as V,o as r,c as u,a as d,F as L,i as Q,j as me,b as s,w as E,t as I,n as q,k as o,l as fe,v as ge,m as pe,q as M,e as be,s as he,x as v,y as R,z as ye,A as ve,B as _e,C as j,D as ke,E as we,G as w,H as xe,I as i,P as U,J as $e,K as B,L as Ve,M as Ce,N as Se,O as Te,Q as je,R as Ue,S as Ee}from"./DdLyLZKU.js";import{r as Le}from"./py6gNnGT.js";import{_ as Re,a as ze,b as Be}from"./BWwWHkwz.js";import{r as Ie,_ as Me,a as Ne,b as De,c as Oe}from"./CsBA1Ej4.js";import{_ as qe}from"./C3wLXaW9.js";import{T as Pe,_ as Je}from"./DiH-kRt9.js";import{u as Qe}from"./Caq1kVlC.js";import"./Bkz9daxz.js";const Fe={class:"mb-4"},He={class:"hidden sm:block"},Ke={class:"relative rounded-lg shadow flex divide-x divide-gray-200 dark:divide-gray-700","aria-label":"Tabs"},We=["onMouseup"],Ae=["onClick"],Ge={class:"absolute right-[1em] focus:outline-none"},Xe=d("span",{"aria-hidden":"true",class:"absolute inset-x-0 bottom-0 h-0.5 bg-transparent dark:bg-gray-600"},null,-1),Ye=z({__name:"BacktestTabs",props:{tabs:{}},emits:["close"],setup(C,{emit:l}){const m=J(),h=V(m.params.id),c=l;function f(a){if(!a.form.routes.length)return"New Tab";if(a.results.exception.error&&a.results.executing)return"Error";const p=a.form.routes[0];let g="";return p.strategy&&(g+=`${p.strategy} • `),p.symbol&&(g+=`${p.symbol} • `),p.timeframe&&(g+=`${p.timeframe}`),g=g.endsWith(" • ")?g.slice(0,-3):g,a.results.executing?`${g} | ${a.results.progressbar.current}%`:a.results.showResults?`${g} | Results`:g}return(a,p)=>{const g=be;return r(),u("div",Fe,[d("div",He,[d("nav",Ke,[(r(!0),u(L,null,Q(a.tabs,b=>(r(),u("div",{key:b.id,class:"relative group min-w-0 flex-1 overflow-hidden text-center flex items-center",onMouseup:me(y=>c("close",b.id),["middle"])},[s(g,{to:`/backtest/${b.id}`,class:q([b.id===o(h)?"text-gray-900 dark:text-gray-100 font-bold ":"text-gray-500 dark:text-gray-300 hover:text-gray-700 font-medium ","py-3 px-4 inline-block select-none cursor-pointer focus:outline-none w-full text-xs bg-gray-50 dark:bg-backdrop-dark"])},{default:E(()=>[d("span",null,I(f(b)),1),d("span",{"aria-hidden":"true",class:q([b.id===o(h)&&Object.keys(a.tabs).length>1?"bg-indigo-400":"bg-transparent dark:bg-gray-600","absolute inset-x-0 bottom-0 h-0.5"])},null,2)]),_:2},1032,["to","class"]),fe(d("button",{class:"absolute right-[1em] focus:outline-none",onClick:y=>c("close",b.id)},[s(o(pe),{class:"h-5 w-5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 hover:bg-gray-200 bg-gray-100 dark:bg-gray-700 rounded-full","aria-hidden":"true"})],8,Ae),[[ge,Object.keys(a.tabs).length>1]])],40,We))),128)),d("div",{class:"select-none cursor-pointer text-gray-400 dark:text-gray-100 hover:text-gray-600 focus:outline-none group relative w-14 overflow-hidden bg-gray-50 dark:bg-backdrop-dark py-3 px-4 font-medium hover:bg-white dark:hover:bg-gray-800 flex items-center justify-center",onClick:p[0]||(p[0]=b=>o(M)().addTab())},[d("button",Ge,[s(o(Le),{class:"h-6 w-6 rounded-full","aria-hidden":"true"})]),Xe])])])])}}}),P={width:800,height:300,priceScale:{borderColor:"rgba(197, 203, 206, 1)"},timeScale:{borderColor:"rgba(197, 203, 206, 1)",timeVisible:!0,secondsVisible:!1}},Ze={chart:{layout:{background:{color:"#ffffff"},textColor:"rgba(33, 56, 77, 1)"},grid:{vertLines:{color:"#f1f1f1",visible:!0},horzLines:{color:"#f1f1f1",visible:!0}},priceScale:{borderColor:"rgba(197, 203, 206, 0.6)"},timeScale:{borderColor:"rgba(197, 203, 206, 0.6)",timeVisible:!0,secondsVisible:!1}}},et={chart:{layout:{background:{color:"#333333"},textColor:"#D1D5DB"},grid:{vertLines:{color:"#525252",visible:!0},horzLines:{color:"#525252",visible:!0}},priceScale:{borderColor:"#525252"},timeScale:{borderColor:"#525252",timeVisible:!0,secondsVisible:!1}}},tt={class:"mt-2"},st={class:"ml-2"},ot=z({__name:"EquityCurve",props:{data:{}},setup(C){const l=he(),m=v(()=>l.value),h=V();let c=null,f=[];const a=C;R(a.data,y=>{}),R(m,y=>{b(y)}),ye(async()=>{await p()});async function p(){P.width=h.value.clientWidth,c=Pe(h.value,P);for(const y of a.data){const S=c.addLineSeries({lineWidth:2});S.setData(y.data),f.push(S)}c.timeScale().fitContent(),b(m.value)}ve(()=>{g()});function g(){c!==null&&(c.remove(),c=null),f&&(f=[])}function b(y){c===null||f===null||c.applyOptions(y==="light"?Ze.chart:et.chart)}return(y,S)=>(r(),u(L,null,[d("div",{ref_key:"chartContainer",ref:h,class:"rounded overflow-hidden border-2 border-gray-100 dark:border-gray-600"},null,512),d("div",tt,[(r(!0),u(L,null,Q(y.data,T=>(r(),u("span",{key:T.name,class:"text-xs mr-2 rounded bg-white dark:bg-gray-700 p-1"},[d("span",{class:"inline-block",style:_e({backgroundColor:T.color,width:"25px",height:"10px"})},null,4),d("span",st,I(T.name),1)]))),128))])],64))}}),rt=["value"],lt={key:1,class:"flex flex-col items-center justify-center select-none mt-[10%]"},at=["textContent"],nt={class:"mt-8"},it={class:"mt-8"},ut={class:"mt-4"},dt=["href"],ct={key:1,class:"mx-auto container mt-8"},mt={key:0,class:"mb-10"},ft={key:1},gt={class:"flex items-center select-none flex-1 my-4"},pt={class:"grid grid-cols-1 gap-6 mt-8"},bt={key:2,class:"w-full mx-auto"},ht={key:6,class:"text-yellow-500 border-yellow-400 bg-yellow-50 dark:bg-gray-700 dark:text-yellow-400 mt-16 text-center text-2xl rounded border-2 border-dashed dark:border-gray-800 py-16 select-none"},yt={key:0},vt={key:0},_t=["href"],kt=["href"],wt=["href"],xt=["href"],$t=["href"],Vt=["href"],Ct=d("hr",{class:"my-8 border-2 dark:border-gray-600 rounded-full"},null,-1),St={key:1},Tt=z({__name:"BacktestTab",props:{form:{},results:{}},setup(C){const l=C,m=V([]),h=V(!1),c=V(!1),f=j().authToken,a=V(ke().public.apiBaseUrl),p=M(),g=v(()=>j().jesseSupportedTimeframes.map(e=>({label:e,value:e}))),b=V([]);async function y(){b.value=await j().getExchangeSupportedSymbols(l.form.exchange);for(let e=0;e<l.form.routes.length;e++)l.form.routes[e].symbol=b.value[0];if(l.form.data_routes.length>0)for(let e=0;e<l.form.data_routes.length;e++)l.form.data_routes[e].symbol=b.value[0]}l.form.exchange=l.form.exchange||j().backtestingExchangeNames[0],y();const{cancel:S,rerun:T,newBacktest:F}=p;function H(e){if(m.value.length){for(let t=0;t<m.value.length;t++)B("error",m.value[t]);return}p.start(e)}const K=e=>{if(m.value.length){for(let t=0;t<m.value.length;t++)B("error",m.value[t]);return}p.startInNewTab(e)},W=v(()=>{let e=`/download/backtest/chart/${l.results.generalInfo.session_id}?token=${f}`;return a.value!=="/"&&(e=a.value+e),e}),N=v(()=>{let e=`/download/backtest/log/${l.results.generalInfo.session_id}?token=${f}`;return a.value!=="/"&&(e=a.value+e),e}),A=v(()=>{let e=`/download/backtest/tradingview/${l.results.generalInfo.session_id}?token=${f}`;return a.value!=="/"&&(e=a.value+e),e}),G=v(()=>{let e=`/download/backtest/full-reports/${l.results.generalInfo.session_id}?token=${f}`;return a.value!=="/"&&(e=a.value+e),e}),X=v(()=>{let e=`/download/backtest/csv/${l.results.generalInfo.session_id}?token=${f}`;return a.value!=="/"&&(e=a.value+e),e}),Y=v(()=>{let e=`/download/backtest/json/${l.results.generalInfo.session_id}?token=${f}`;return a.value!=="/"&&(e=a.value+e),e}),k=v(()=>l.results.metrics.length>0),Z=v(()=>we.remainingTimeText(l.results.progressbar.estimated_remaining_seconds));function ee(){navigator.clipboard.writeText(l.results.infoLogs),B("success","Logs copied successfully"),c.value=!0,setTimeout(()=>{c.value=!1},3e3)}return R(()=>l.form.start_date,e=>{l.form.finish_date<e&&(l.form.finish_date=e)}),R(()=>l.form.finish_date,e=>{l.form.finish_date&&l.form.start_date>e&&(l.form.start_date=e)}),(e,t)=>{const te=Re,se=Ve,oe=Me,_=Ce,re=Ne,le=De,$=Se,ae=qe,ne=ze,D=Te,x=je,ie=Be,O=Ue,ue=ot,de=Je,ce=Oe;return r(),u(L,null,[e.form.debug_mode?(r(),w(se,{key:0,modelValue:e.results.logsModal,"onUpdate:modelValue":t[0]||(t[0]=n=>e.results.logsModal=n),title:"Logs"},{default:E(()=>[s(te,{logs:e.results.infoLogs},null,8,["logs"])]),buttons:E(()=>[d("button",{class:"ml-2 p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:ee},[o(c)?(r(),w(o(xe),{key:0,class:"h-6 w-6","aria-hidden":"true"})):i("",!0),!o(c)&&e.results.infoLogs.length!=0?(r(),w(o(Ie),{key:1,class:"h-6 w-6","aria-hidden":"true"})):i("",!0)]),d("input",{id:"copy-info-logs",type:"hidden",value:e.results.infoLogs},null,8,rt)]),_:1},8,["modelValue"])):i("",!0),e.results.executing&&!e.results.showResults?(r(),u("div",lt,[d("div",null,[s(oe,{progress:e.results.progressbar.current},null,8,["progress"])]),e.results.exception.error?i("",!0):(r(),u("h3",{key:0,class:"mt-8 animate-pulse",textContent:I(o(Z))},null,8,at)),d("div",nt,[d("div",it,[s(_,{color:"gray",ui:{color:{gray:{solid:"text-rose-500 dark:text-rose-400"}}},class:"w-64 flex justify-center",icon:"i-heroicons-no-symbol",size:"xl",variant:"solid",label:"Cancel",trailing:!1,onClick:t[1]||(t[1]=n=>o(S)((e._.provides[U]||e.$route).params.id))})]),d("div",ut,[e.form.debug_mode&&e.results.exception.error&&e.results.progressbar.current!==0?(r(),u("a",{key:0,href:o(N),class:"flex justify-center items-center btn-secondary text-center mb-4 w-full"},[s(_,{icon:"i-heroicons-document-arrow-down",label:"Debugging Logs",color:"gray",size:"xl",variant:"solid",trailing:!1,class:"w-64 flex justify-center"})],8,dt)):i("",!0)])]),e.results.exception.error&&e.results.executing?(r(),u("div",ct,[s(re,{modelValue:o(h),"onUpdate:modelValue":t[2]||(t[2]=n=>$e(h)?h.value=n:null),title:e.results.exception.error,content:e.results.exception.traceback,mode:"backtest","debug-mode":e.form.debug_mode},null,8,["modelValue","title","content","debug-mode"])])):i("",!0)])):i("",!0),s(ce,{else:""},{left:E(()=>[e.results.showResults&&e.results.alert.message?(r(),u("div",mt,[s(le,{color:"teal",icon:"i-heroicons-check-circle",variant:"soft",title:e.results.alert.message,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"white",variant:"link"},onClose:t[3]||(t[3]=n=>e.results.alert.message="")},null,8,["title"])])):i("",!0),!e.results.executing&&!e.results.showResults?(r(),u("div",ft,[s($,{class:"mb-4",title:"Exchange"}),s(ae,{modelValue:e.form.exchange,"onUpdate:modelValue":t[4]||(t[4]=n=>e.form.exchange=n),placeholder:"Select an exchange...",searchable:"",options:o(j)().backtestingExchangeNames,size:"lg",class:"mt-2 mb-16",onChange:y},null,8,["modelValue","options"]),s(ne,{"total-routes-error":o(m),timeframes:o(g),form:e.form,results:e.results,symbols:o(b),mode:"backtest"},null,8,["total-routes-error","timeframes","form","results","symbols"]),s($,{class:"mt-16",title:"Duration"}),d("div",gt,[s(D,{modelValue:e.form.start_date,"onUpdate:modelValue":t[5]||(t[5]=n=>e.form.start_date=n),type:"date",variant:"outline",size:"lg",class:"w-full mr-2"},null,8,["modelValue"]),s(D,{modelValue:e.form.finish_date,"onUpdate:modelValue":t[6]||(t[6]=n=>e.form.finish_date=n),type:"date",variant:"outline",size:"lg",class:"w-full ml-2"},null,8,["modelValue"])]),s($,{class:"mt-16",title:"Options"}),d("div",pt,[s(x,{modelValue:e.form.debug_mode,"onUpdate:modelValue":t[7]||(t[7]=n=>e.form.debug_mode=n),title:"Debug Mode",description:"Logs every step of the execution. Very helpful for debugging your strategy but takes a lot longer to execute"},null,8,["modelValue"]),s(x,{modelValue:e.form.export_chart,"onUpdate:modelValue":t[8]||(t[8]=n=>e.form.export_chart=n),title:"Export Charts",description:"Exports charts for your portfolio's daily balance."},null,8,["modelValue"]),s(x,{modelValue:e.form.export_tradingview,"onUpdate:modelValue":t[9]||(t[9]=n=>e.form.export_tradingview=n),title:"Export Tradingview",description:"Exports the executed trades in a format accepted by TradingView's Pine Editor. Useful to look at the executed orders on their chart."},null,8,["modelValue"]),s(x,{modelValue:e.form.export_full_reports,"onUpdate:modelValue":t[10]||(t[10]=n=>e.form.export_full_reports=n),title:"Export QuantStats reports",description:"Exports a HTML file generated by QuantStats library."},null,8,["modelValue"]),s(x,{modelValue:e.form.export_csv,"onUpdate:modelValue":t[11]||(t[11]=n=>e.form.export_csv=n),title:"Export CSV",description:"Exports executed trades in a CSV format"},null,8,["modelValue"]),s(x,{modelValue:e.form.export_json,"onUpdate:modelValue":t[12]||(t[12]=n=>e.form.export_json=n),title:"Export JSON",description:"Exports executed trades in a JSON format"},null,8,["modelValue"]),s(x,{modelValue:e.form.fast_mode,"onUpdate:modelValue":t[13]||(t[13]=n=>e.form.fast_mode=n),title:"Fast Mode",description:"Runs the backtest faster by using an improved algorithm. This is supposed to yield the same results; however, it's currently experimental, which is why it's an option."},null,8,["modelValue"]),s(x,{modelValue:e.form.benchmark,"onUpdate:modelValue":t[14]||(t[14]=n=>e.form.benchmark=n),title:"Benchmark",description:"If enabled, the backtest will compare the performance of the strategy against the buy and hold strategy of the market."},null,8,["modelValue"])])])):i("",!0),e.results.showResults?(r(),u("div",bt,[d("div",null,[s($,{title:"Routes",class:"mb-4"}),s(ie,{data:e.results.routes_info,"header-items":["Symbol","Timeframe","Strategy"],header:""},null,8,["data"]),e.results.hyperparameters.length?(r(),w($,{key:0,class:"mt-16 mb-4",title:"Hyperparameters"})):i("",!0),e.results.hyperparameters.length?(r(),w(O,{key:1,data:e.results.hyperparameters},null,8,["data"])):i("",!0),o(k)?(r(),w($,{key:2,class:"mt-16 mb-4",title:"Equity Curve"})):i("",!0),o(k)?(r(),w(ue,{key:3,data:e.results.charts.equity_curve},null,8,["data"])):i("",!0),o(k)?(r(),w($,{key:4,class:"mt-16 mb-4",title:"Performance"})):i("",!0),o(k)?(r(),w(O,{key:5,data:e.results.metrics},null,8,["data"])):i("",!0),o(k)?i("",!0):(r(),u("div",ht," No trades were executed via this strategy! "))])])):i("",!0)]),right:E(()=>[e.results.executing?i("",!0):(r(),u("div",yt,[e.results.showResults?(r(),u("div",vt,[s(_,{class:"w-full flex justify-center",icon:"i-heroicons-arrow-path",size:"xl",variant:"solid",label:"Rerun",trailing:!1,onClick:t[15]||(t[15]=n=>o(T)((e._.provides[U]||e.$route).params.id))}),s(_,{class:"w-full flex justify-center mt-4",color:"green",icon:"i-heroicons-arrow-uturn-left",size:"xl",variant:"solid",label:"New session",trailing:!1,onClick:t[16]||(t[16]=n=>o(F)((e._.provides[U]||e.$route).params.id))}),e.form.debug_mode?(r(),u("a",{key:0,href:o(N),target:"_blank",class:""},[s(_,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"Debugging Logs",trailing:!1})],8,_t)):i("",!0),e.form.export_chart&&o(k)?(r(),u("a",{key:1,href:o(W),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[s(_,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:" Legacy Chart",trailing:!1})],8,kt)):i("",!0),e.form.export_full_reports&&o(k)?(r(),u("a",{key:2,href:o(G),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[s(_,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"QuantStats Report",trailing:!1})],8,wt)):i("",!0),e.form.export_csv&&o(k)?(r(),u("a",{key:3,href:o(X),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[s(_,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"CVS",trailing:!1})],8,xt)):i("",!0),e.form.export_json&&o(k)?(r(),u("a",{key:4,href:o(Y),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[s(_,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"JSON",trailing:!1})],8,$t)):i("",!0),e.form.export_tradingview&&o(k)?(r(),u("a",{key:5,href:o(A),target:"_blank",class:"flex justify-center items-center btn-secondary text-center mb-4 w-full"},[s(_,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"TradingView Pine Editor",trailing:!1})],8,Vt)):i("",!0),Ct,s(de,{data:e.results.info},null,8,["data"])])):(r(),u("div",St,[s(_,{class:"w-full flex justify-center",icon:"i-heroicons-bolt",size:"xl",variant:"solid",label:"Start",trailing:!1,onClick:t[17]||(t[17]=n=>H((e._.provides[U]||e.$route).params.id))}),s(_,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-plus",size:"xl",variant:"solid",label:"Start in a new tab",trailing:!1,onClick:t[18]||(t[18]=n=>K((e._.provides[U]||e.$route).params.id))})]))]))]),_:1})],64)}}}),jt={class:"w-full"},Nt=z({__name:"[id]",setup(C){Qe({title:"Backtest - Jesse"});const l=M(),m=v(()=>l.tabs),h=v(()=>J().params.id),c=v(()=>{if(!m.value[h.value]){const f=Object.keys(m.value);if(f.length>0){const a=m.value[f[0]];return Ee().push(`/backtest/${a.id}`),a}}return m.value[h.value]});return Object.keys(m.value).length===0&&l.addTab(),(f,a)=>{const p=Ye,g=Tt;return r(),u(L,null,[d("div",jt,[s(p,{tabs:m.value,mode:"backtest",onClose:o(l).closeTab},null,8,["tabs","onClose"])]),c.value?(r(),w(g,{key:0,form:c.value.form,results:c.value.results},null,8,["form","results"])):i("",!0)],64)}}});export{Nt as default};
