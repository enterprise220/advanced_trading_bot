import{_ as q}from"./CPy8M_3c.js";import{o as i,c,b as r,h as z,V as I,s as N,r as $,D as o,E as F,t as S,W as h,d as n,F as j,n as B,K as U,I as G,j as A,k as K,w as v,X as p,y as L,Y as W,e as M,v as R}from"./BlrvtiIG.js";import{u as X}from"./BWJPrTne.js";import{r as T}from"./BWSdnu8b.js";function D(x,t){return i(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}const Y={class:"relative"},H=["onClick"],J={class:"w-full text-sm text-left"},P={key:0},Q=z({__name:"MultipleSelect",props:I({options:{}},{modelValue:{type:Array,default:[]},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const t=N(x,"modelValue"),V=x,a=$(!1);function C(u){return t.value.some(d=>d.key===u.key)}function m(u){const d=t.value.findIndex(f=>f.key===u.key);d===-1?t.value.push(u):t.value.splice(d,1)}return(u,d)=>(i(),c("div",Y,[o(a)?(i(),c("div",{key:0,class:"fixed inset-0 w-screen z-10",onClick:d[0]||(d[0]=f=>a.value=!o(a))})):F("",!0),r("button",{class:h(["relative min-w-40 w-full bg-white dark:bg-gray-900 flex justify-between items-center px-2 py-0.5 rounded-md border-[2px] border-gray-300 dark:border-gray-700",o(a)?"z-20":""]),onClick:d[1]||(d[1]=f=>a.value=!o(a))},[r("div",null,S(t.value.length)+" selected ",1),r("div",{class:h(["transition-all duration-200",o(a)?"-rotate-180":"rotate-0"])},[n(o(D),{class:"h-3 w-3 text-gray-400 dark:text-gray-600"})],2)],2),r("div",{class:h(["absolute w-full max-h-60 overflow-y-scroll top-9 bg-white dark:bg-gray-900 right-0 transition-all rounded-md border-[2px] border-gray-300 dark:border-gray-700 z-20 p-0.5",o(a)?"h-60 opacity-100":"h-0 opacity-0 pointer-events-none"])},[(i(!0),c(j,null,B(V.options,f=>(i(),c("button",{key:f.key,class:"w-full flex justify-between items-center hover:bg-gray-100 hover:dark:bg-gray-800 p-1 rounded-md",onClick:O=>m(f)},[r("div",J,S(f.label),1),C(f)?(i(),c("div",P,[n(o(U),{class:"h-4 w-4 text-gray-600 dark:text-gray-400"})])):F("",!0)],8,H))),128))],2)]))}}),Z={class:"relative"},ee=["onClick"],te={class:"w-full text-sm text-left"},re={key:0},oe=z({__name:"SingleSelect",props:I({options:{}},{modelValue:{type:Object,default:{}},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const t=N(x,"modelValue"),V=x,a=$(!1);function C(m){t.value.key=m.key,t.value.label=m.label}return(m,u)=>(i(),c("div",Z,[o(a)?(i(),c("div",{key:0,class:"fixed inset-0 w-screen z-10",onClick:u[0]||(u[0]=d=>a.value=!o(a))})):F("",!0),r("button",{class:h(["relative min-w-40 w-full bg-white dark:bg-gray-900 flex justify-between items-center px-2 py-0.5 rounded-md border-[2px] border-gray-300 dark:border-gray-700",o(a)?"z-20":""]),onClick:u[1]||(u[1]=d=>a.value=!o(a))},[r("div",null,S(t.value.label),1),r("div",{class:h(["transition-all duration-200",o(a)?"-rotate-180":"rotate-0"])},[n(o(D),{class:"h-3 w-3 text-gray-400 dark:text-gray-600"})],2)],2),r("div",{class:h(["absolute w-full max-h-60 overflow-y-scroll top-9 bg-white dark:bg-gray-900 right-0 transition-all rounded-md border-[2px] border-gray-300 dark:border-gray-700 z-20 p-0.5",o(a)?"h-60 opacity-100":"h-0 opacity-0 pointer-events-none"])},[(i(!0),c(j,null,B(V.options,d=>(i(),c("button",{key:d.key,class:"w-full flex justify-between items-center hover:bg-gray-100 hover:dark:bg-gray-800 p-1 rounded-md",onClick:f=>C(d)},[r("div",te,S(d.label),1),d.key==t.value.key?(i(),c("div",re,[n(o(U),{class:"h-4 w-4 text-gray-600 dark:text-gray-400"})])):F("",!0)],8,ee))),128))],2)]))}}),se={class:"w-full"},ae={class:"mt-8 p-4"},ne={class:"lg:flex justify-center items-center mb-4"},le={class:"md:flex justify-center items-center mb-4 lg:mb-0"},ie={class:"flex justify-center items-center mb-4 md:mb-0"},de=r("div",{class:"font-bold whitespace-nowrap mr-4"},"Filter by:",-1),ce={class:"flex justify-center items-center md:ml-4"},ue=r("div",{class:"font-bold whitespace-nowrap mr-4"},"Sort by:",-1),pe={class:"flex justify-center items-center lg:ml-4"},me=r("div",{class:"font-bold mr-4"},"Actions:",-1),_e={class:"flex"},fe={class:"flex flex-col border-r-2 font-bold"},be=r("div",{class:"border-b-2 h-20"},null,-1),ge={class:"flex overflow-x-auto"},ye={class:"px-4 flex items-center justify-center border-b border-t-2 h-20 bg-white dark:bg-backdrop-dark"},ke={class:"text-gray-700 dark:text-gray-300 truncate"},Ce=z({__name:"benchmark",setup(x){X({title:"Benchmark"});const t=G(),V=A(()=>t.tabs),a=$(t.benchmarkColumns),C=$(t.benchmarkSorts);t.benchmarkFilters.length===0&&t.setBenchmarkFilters(a.value);const m=$(t.benchmarkFilters);Object.keys(t.benchmarkSelectedSort).length==0&&t.setBenchmarkSort(C.value[0]);const u=$(t.benchmarkSelectedSort),d=A(()=>{var b,y,k;const w=t.tabs,_=[];for(const g in w){const l=w[g],e={id:l.id,strategy:((b=l.form.routes[0])==null?void 0:b.strategy)??"",start_date:l.form.start_date,finish_date:l.form.finish_date,fast_mode:l.form.fast_mode,exchange:l.form.exchange,symbol:((y=l.form.routes[0])==null?void 0:y.symbol)??"",timeframe:((k=l.form.routes[0])==null?void 0:k.timeframe)??""},s=l.results.metrics;Object.keys(s).length>0&&(e.total_closed_trades=s.total,e.net_profit=p.round(s.net_profit,1),e.net_profit_percentage=`${p.round(s.net_profit_percentage,1)} %`,e.total_paid_fees=p.round(s.fee,1),e.max_drawdown=`${p.round(s.max_drawdown,1)} %`,e.annual_return=`${p.round(s.annual_return,1)} %`,e.expectancy=`${p.round(s.expectancy_percentage,1)} %`,e.ratio_avg_win_loss=p.round(s.ratio_avg_win_loss,1),e.win_rate=`${p.round(s.win_rate*100,1)} %`,e.longs_percentage=`${p.round(s.longs_percentage,1)} %`,e.shorts_percentage=`${p.round(s.shorts_percentage,1)} %`,e.average_holding_hours=p.round(s.average_holding_period/3600,1),e.sharpe_ratio=p.round(s.sharpe_ratio,1),e.sortino_ratio=p.round(s.sortino_ratio,1),e.calmar_ratio=p.round(s.calmar_ratio,1),e.omega_ratio=p.round(s.omega_ratio,1)),l.results.executing&&!l.results.exception.error?(e.progress=`${l.results.progressbar.current}%`,e.status="running"):l.results.exception.error&&l.results.executing?(e.progress="❌",e.status="error"):Object.keys(s).length===0?e.status="":(e.progress="✅",e.status="finished"),_.push(e)}return _}),f=A(()=>u.value.key=="none"?d.value:[...d.value].sort((w,_)=>{const b=u.value.key,y=parseFloat(w[b])||null,k=parseFloat(_[b])||null;return y===null&&k===null?0:y===null?1:k===null||y>k?-1:y<k?1:0}));function O(){m.value.sort((w,_)=>a.value.findIndex(b=>b.key===w.key)-a.value.findIndex(b=>b.key===_.key)),t.setBenchmarkFilters(m.value)}return K(m,O,{deep:!0}),(w,_)=>{const b=q,y=Q,k=oe,g=L,l=W;return i(),c(j,null,[r("div",se,[n(b,{"current-tab":null,tabs:V.value,mode:"backtest",onClose:o(t).closeTab},null,8,["tabs","onClose"])]),r("div",ae,[r("div",ne,[r("div",le,[r("div",ie,[de,n(y,{modelValue:m.value,"onUpdate:modelValue":_[0]||(_[0]=e=>m.value=e),options:a.value},null,8,["modelValue","options"])]),r("div",ce,[ue,n(k,{modelValue:u.value,"onUpdate:modelValue":_[1]||(_[1]=e=>u.value=e),options:C.value},null,8,["modelValue","options"])])]),r("div",pe,[me,n(g,{icon:"i-heroicons-arrow-path",onClick:o(t).rerunAll},{default:v(()=>[M("Rerun All")]),_:1},8,["onClick"]),n(g,{icon:"i-heroicons-arrow-path",class:"ml-4",color:"rose",onClick:o(t).rerunFailed},{default:v(()=>[M(" Rerun Failed Only ")]),_:1},8,["onClick"]),n(g,{icon:"i-heroicons-stop",class:"ml-4",color:"gray",onClick:o(t).cancelAllRunning},{default:v(()=>[M(" Cancel All ")]),_:1},8,["onClick"])])]),r("div",null,[r("div",_e,[r("div",fe,[be,(i(!0),c(j,null,B(m.value,(e,s)=>(i(),c("div",{key:e.key,class:h(["text-sm uppercase border-b min-w-[13rem] min-h-[4rem] border-l flex items-center justify-center",s%2===0?"bg-white dark:bg-backdrop-dark":"bg-gray-50 dark:bg-gray-800"])},[r("span",null,S(e.label),1)],2))),128))]),r("div",ge,[(i(!0),c(j,null,B(f.value,e=>(i(),c("div",{key:e.id,class:"flex flex-col border-r"},[r("div",ye,[n(l,{text:"Rerun","open-delay":500,popper:{arrow:!0}},{default:v(()=>[n(g,{class:"mr-2",variant:"ghost",icon:"i-heroicons-arrow-path",disabled:e.status==="running",onClick:s=>o(t).rerun(e.id)},null,8,["disabled","onClick"])]),_:2},1024),n(l,{text:"Go to backtest page","open-delay":500,popper:{arrow:!0}},{default:v(()=>[n(g,{to:`/backtest/${e.id}`,class:"mr-2",variant:"ghost",color:"gray",icon:"i-heroicons-arrow-top-right-on-square"},null,8,["to"])]),_:2},1024),n(l,{text:"Duplicate","open-delay":500,popper:{arrow:!0}},{default:v(()=>[n(g,{class:"mr-2",variant:"ghost",icon:"i-heroicons-document-duplicate",color:"blue",onClick:s=>o(t).duplicateTab(e.id)},null,8,["onClick"])]),_:2},1024),e.status==="running"?(i(),R(l,{key:0,text:"Cancel","open-delay":500,popper:{arrow:!0}},{default:v(()=>[n(g,{variant:"ghost",icon:"i-heroicons-stop",color:"gray",onClick:s=>o(t).cancel(e.id)},null,8,["onClick"])]),_:2},1024)):(i(),R(l,{key:1,text:"Close tab","open-delay":500,popper:{arrow:!0}},{default:v(()=>[n(g,{variant:"ghost",icon:"i-heroicons-trash",color:"red",disabled:Object.keys(f.value).length==1,onClick:s=>o(t).closeTab(e.id)},null,8,["disabled","onClick"])]),_:2},1024))]),(i(!0),c(j,null,B(m.value,(s,E)=>(i(),c("div",{key:s.key,class:h(["border-b min-w-[6rem] text-center min-h-[4rem] w-[13em]",e.status==="running"?"animate-pulse":""])},[r("div",{class:h(["px-4 py-4 w-full h-full truncate flex items-center justify-center",E%2===0?"bg-white dark:bg-backdrop-dark":"bg-gray-50 dark:bg-gray-800"])},[r("span",ke,S(e[s.key]||"-"),1)],2)],2))),128))]))),128)),n(l,{text:"Add New Tab","open-delay":500,popper:{arrow:!0}},{default:v(()=>[r("button",{class:"w-20 h-full px-4 flex flex-col justify-between items-center border-dashed border-2 bg-white hover:bg-gray-50 dark:bg-backdrop-dark hover:dark:bg-gray-800 py-10",onClick:_[2]||(_[2]=e=>o(t).addTab())},[n(o(T),{class:"h-6 w-6 text-gray-400 dark:text-gray-100"}),n(o(T),{class:"h-6 w-6 text-gray-400 dark:text-gray-100"}),n(o(T),{class:"h-6 w-6 text-gray-400 dark:text-gray-100"})])]),_:1})])])])])],64)}}});export{Ce as default};
